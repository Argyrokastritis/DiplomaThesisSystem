<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>ÎšÎ±Î¸Î·Î³Î·Ï„Î®Ï‚ - Î Î¯Î½Î±ÎºÎ±Ï‚ Î•Î»Î­Î³Ï‡Î¿Ï…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      padding: 20px;
      max-width: 1000px;
      margin: auto;
      background: linear-gradient(135deg, #ece9e6, #ffffff);
      color: #333;
    }
    h2 { color: #444; text-align: center; margin-bottom: 20px; }
    h3 { color: #555; margin-bottom: 10px; }
    input, textarea, button, select {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }
    button:hover {
      background-color: #45a049;
    }
    .section {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    .topic, .thesis {
      background: #fafafa;
      padding: 12px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    .topic button, .thesis button {
      width: auto;
      margin-top: 8px;
      padding: 8px 12px;
      font-size: 13px;
    }
    .search-box {
  display: flex;
  gap: 8px;
  margin-bottom: 15px;
  align-items: center;
}

.search-box input {
  flex: 1;
  padding: 8px;
  font-size: 14px;
}

.search-box button {
  flex: 0;
  padding: 8px 14px;
  font-size: 14px;
  background-color: #007BFF;
  border-radius: 6px;
  border: none;
  color: white;
  cursor: pointer;
  transition: 0.3s;
}

.search-box button:hover {
  background-color: #0056b3;
}

  </style>
</head>
<body>

  <h2>ğŸ‘¨â€ğŸ« Î Î¯Î½Î±ÎºÎ±Ï‚ Î•Î»Î­Î³Ï‡Î¿Ï… ÎšÎ±Î¸Î·Î³Î·Ï„Î®</h2>

  <!-- Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î¿Ï… Î¸Î­Î¼Î±Ï„Î¿Ï‚ -->
  <div class="section">
    <h3>â• Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î˜Î­Î¼Î±Ï„Î¿Ï‚ Î”Î¹Ï€Î»Ï‰Î¼Î±Ï„Î¹ÎºÎ®Ï‚</h3>
    <form id="topicForm">
      <input type="text" id="title" placeholder="Î¤Î¯Ï„Î»Î¿Ï‚ Î˜Î­Î¼Î±Ï„Î¿Ï‚" required>
      <textarea id="summary" placeholder="Î£ÏÎ½Ï„Î¿Î¼Î· Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®" required></textarea>
      <input type="file" id="pdfFile">
      <button type="submit">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î˜Î­Î¼Î±Ï„Î¿Ï‚</button>
    </form>
  </div>

<!-- Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Ï†Î¿Î¹Ï„Î·Ï„Î® -->
<div class="section">
  <h3>ğŸ” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î¿Î¹Ï„Î·Ï„Î®</h3>
  <div class="search-box">
    <input type="text" id="studentSearch" placeholder="Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ ÏŒÎ½Î¿Î¼Î± Ï†Î¿Î¹Ï„Î·Ï„Î®...">
    <button type="button" onclick="searchStudent()">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·</button>
  </div>
  <div id="studentResults"></div>
</div>

<script>
  async function searchStudent() {
    const query = document.getElementById('studentSearch').value.trim();
    if (!query) {
      studentResults.innerHTML = "<p>âš ï¸ Î Î»Î·ÎºÏ„ÏÎ¿Î»Î¿Î³Î®ÏƒÏ„Îµ ÏŒÎ½Î¿Î¼Î± Ï†Î¿Î¹Ï„Î·Ï„Î®.</p>";
      return;
    }

    try {
      const res = await fetch(`http://localhost:5000/api/students/search?name=${encodeURIComponent(query)}`, {
        headers: { Authorization: `Bearer ${token}` }
      });

      if (!res.ok) {
        throw new Error("Î£Ï†Î¬Î»Î¼Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚ Î¼Îµ Ï„Î¿Î½ server");
      }

      const students = await res.json();
      studentResults.innerHTML = '';

      if (students.length === 0) {
        studentResults.innerHTML = "<p>âŒ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Ï†Î¿Î¹Ï„Î·Ï„Î­Ï‚.</p>";
        return;
      }

      students.forEach(s => {
        const div = document.createElement('div');
        div.className = 'topic';
        div.innerHTML = `
          <strong>ğŸ‘¨â€ğŸ“ ${s.name}</strong><br>
          Î‘Îœ: ${s.am || '-'}<br>
          Email: ${s.email || '-'}
        `;
        studentResults.appendChild(div);
      });

    } catch (err) {
      console.error(err);
      studentResults.innerHTML = "<p>âŒ Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·.</p>";
    }
  }

  // âœ… Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÎºÎ±Î¹ Î¼Îµ Enter Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ input
  document.getElementById('studentSearch').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      searchStudent();
    }
  });
</script>

  <!-- Î›Î¯ÏƒÏ„Î± Î¸ÎµÎ¼Î¬Ï„Ï‰Î½ -->
  <div class="section">
    <h3>ğŸ“‹ Î˜Î­Î¼Î±Ï„Î± Ï€Î¿Ï… Î­Ï‡Ï‰ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹</h3>
    <div id="topicList"></div>
  </div>

  <!-- Î›Î¯ÏƒÏ„Î± Î±Î½Î±Î¸Î­ÏƒÎµÏ‰Î½ -->
  <div class="section">
    <h3>ğŸ“š Î‘Î½Î±Î¸Î­ÏƒÎµÎ¹Ï‚</h3>
    <div id="assignmentList"></div>
  </div>

  <script>
  const token = localStorage.getItem('token');
  if (!token) {
    alert('Î ÏÎ­Ï€ÎµÎ¹ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ Ï€ÏÏÏ„Î±.');
    window.location.href = 'login.html';
  }

  const searchInput = document.getElementById('studentSearch');
  const studentResults = document.getElementById('studentResults');

  let searchTimeout;

  searchInput.addEventListener('input', () => {
    clearTimeout(searchTimeout);
    const query = searchInput.value.trim();

    if (!query) {
      studentResults.innerHTML = '';
      return;
    }

    searchTimeout = setTimeout(() => searchStudent(query), 300);
  });

  async function searchStudent(query) {
    try {
      const res = await fetch(
        `http://localhost:5000/api/students/search?name=${encodeURIComponent(query)}`,
        { headers: { Authorization: `Bearer ${token}` } }
      );

      if (!res.ok) throw new Error("Î£Ï†Î¬Î»Î¼Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚ Î¼Îµ Ï„Î¿Î½ server");

      const students = await res.json();
      studentResults.innerHTML = '';

      if (students.length === 0) {
        studentResults.innerHTML = "<p>âŒ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Ï†Î¿Î¹Ï„Î·Ï„Î­Ï‚.</p>";
        return;
      }

      const ul = document.createElement('ul');
      ul.style.listStyle = "none";
      ul.style.padding = "0";

      students.forEach(s => {
        const li = document.createElement('li');
        li.style.padding = "6px";
        li.style.borderBottom = "1px solid #ddd";
        li.style.cursor = "pointer";

        li.innerHTML = `ğŸ‘¨â€ğŸ“ <strong>${s.name}</strong> (${s.email || '-'})`;

        li.onclick = () => {
          alert(`Î•Ï€Î¹Î»Î­Î¾Î±Ï„Îµ Ï„Î¿Î½ Ï†Î¿Î¹Ï„Î·Ï„Î®: ${s.name}`);
          searchInput.value = s.name;
          studentResults.innerHTML = '';
        };

        ul.appendChild(li);
      });

      studentResults.appendChild(ul);

    } catch (err) {
      console.error(err);
      studentResults.innerHTML = "<p>âŒ Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·.</p>";
    }
  }
  // âœ… Î•Î´Ï Î²Î¬Î»Îµ Ï„Î¹Ï‚ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚
  async function loadTopics() {
    const res = await fetch('http://localhost:5000/api/instructors/topics', {
      headers: { Authorization: `Bearer ${token}` }
    });
    const topics = await res.json();

    const topicList = document.getElementById('topicList');
    topicList.innerHTML = '';

    if (Array.isArray(topics)) {
      topics.forEach(t => {
        const div = document.createElement('div');
        div.className = 'topic';
        div.innerHTML = `
          <strong>${t.title}</strong><br>${t.summary}<br>
          <button onclick="editTopic('${t._id}')">âœï¸ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±</button>
          <button onclick="assignTopic('${t._id}')">ğŸ“ Î‘Î½Î¬Î¸ÎµÏƒÎ·</button>`;
        topicList.appendChild(div);
      });
    } else {
      topicList.innerHTML = 'Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ Î¸ÎµÎ¼Î¬Ï„Ï‰Î½.';
      console.log('topics:', topics);
    }
  }

  async function loadAssignments() {
  const res = await fetch('http://localhost:5000/api/instructors/assignments', {
    headers: { Authorization: `Bearer ${token}` }
  });

  const assignments = await res.json();
  const assignmentList = document.getElementById('assignmentList');
  assignmentList.innerHTML = '';

  if (assignments.length === 0) {
    assignmentList.innerHTML = '<p>ğŸ“­ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎµÎ½ÎµÏÎ³Î­Ï‚ Î±Î½Î±Î¸Î­ÏƒÎµÎ¹Ï‚.</p>';
    return;
  }

  assignments.forEach(a => {
    const div = document.createElement('div');
    div.className = 'topic';
    div.innerHTML = `
      <strong>${a.title}</strong><br>
      Î‘Î½Î±Ï„Î­Î¸Î·ÎºÎµ ÏƒÎµ: ğŸ‘¨â€ğŸ“ ${a.assignedTo?.name || 'Î†Î³Î½Ï‰ÏƒÏ„Î¿Ï‚'} (${a.assignedTo?.email || '-'})<br>
      <button onclick="cancelAssignment('${a._id}')">ğŸ—‘ï¸ Î‘ÎºÏÏÏ‰ÏƒÎ· Î‘Î½Î¬Î¸ÎµÏƒÎ·Ï‚</button>
    `;
    assignmentList.appendChild(div);
  });
}


  async function assignTopic(topicId) {
  const studentEmail = prompt("ğŸ“§ Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ email Ï†Î¿Î¹Ï„Î·Ï„Î® Î³Î¹Î± Î±Î½Î¬Î¸ÎµÏƒÎ·:");

  if (!studentEmail) return;

  try {
    // Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Ï†Î¿Î¹Ï„Î·Ï„Î® Î¼Îµ email
    const resStudent = await fetch(`http://localhost:5000/api/students/search?email=${encodeURIComponent(studentEmail)}`, {
      headers: { Authorization: `Bearer ${token}` }
    });

    const students = await resStudent.json();
    if (students.length === 0) {
      alert("âŒ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï†Î¿Î¹Ï„Î·Ï„Î®Ï‚ Î¼Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ email.");
      return;
    }

    const studentId = students[0]._id;

    // Î‘Î½Î¬Î¸ÎµÏƒÎ· Î¸Î­Î¼Î±Ï„Î¿Ï‚
    const resAssign = await fetch('http://localhost:5000/api/instructors/assign-topic', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${token}`
      },
      body: JSON.stringify({ topicId, studentId })
    });

    const result = await resAssign.json();
    if (resAssign.ok) {
      alert("âœ… Î¤Î¿ Î¸Î­Î¼Î± Î±Î½Î±Ï„Î­Î¸Î·ÎºÎµ Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¬!");
      loadAssignments(); // Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬
    } else {
      alert("âŒ Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Î½Î¬Î¸ÎµÏƒÎ·: " + result.message);
    }

  } catch (err) {
    console.error(err);
    alert("âŒ Î£Ï†Î¬Î»Î¼Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚ Î¼Îµ Ï„Î¿Î½ server.");
  }
}

async function cancelAssignment(topicId) {
  if (!confirm("â“ Î˜Î­Î»ÎµÏ„Îµ ÏƒÎ¯Î³Î¿Ï…ÏÎ± Î½Î± Î±ÎºÏ…ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Î±Î½Î¬Î¸ÎµÏƒÎ·;")) return;

  try {
    const res = await fetch('http://localhost:5000/api/instructors/cancel-assignment', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${token}`
      },
      body: JSON.stringify({ topicId })
    });

    const result = await res.json();
    if (res.ok) {
      alert("âœ… Î— Î±Î½Î¬Î¸ÎµÏƒÎ· Î±ÎºÏ…ÏÏÎ¸Î·ÎºÎµ.");
      loadAssignments();
    } else {
      alert("âŒ Î£Ï†Î¬Î»Î¼Î±: " + result.message);
    }
  } catch (err) {
    console.error(err);
    alert("âŒ Î£Ï†Î¬Î»Î¼Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚ Î¼Îµ Ï„Î¿Î½ server.");
  }
}


  function editTopic(id) {
    window.location.href = `edit-topic.html?id=${id}`;
  }

    loadTopics();
    loadAssignments();
  </script>

</body>
</html>
