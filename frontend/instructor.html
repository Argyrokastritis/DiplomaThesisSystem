<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Καθηγητής - Πίνακας Ελέγχου</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; padding: 20px; max-width: 800px; margin: auto; background-color: #f4f4f4; }
    h2 { color: #333; }
    input, textarea, button { width: 100%; padding: 10px; margin: 5px 0; }
    .topic, .thesis { background: #fff; padding: 10px; margin-top: 10px; border-radius: 5px; border: 1px solid #ccc; }
    .section { margin-bottom: 40px; }
  </style>
</head>
<body>

  <h2>👨‍🏫 Πίνακας Ελέγχου Καθηγητή</h2>

  <div class="section">
    <h3>➕ Δημιουργία Θέματος Διπλωματικής</h3>
    <form id="topicForm">
      <input type="text" id="title" placeholder="Τίτλος Θέματος" required>
      <textarea id="summary" placeholder="Σύντομη Περιγραφή" required></textarea>
      <input type="file" id="pdfFile">
      <button type="submit">Αποθήκευση Θέματος</button>
    </form>
  </div>

  <div class="section">
    <h3>📋 Θέματα που έχω δημιουργήσει</h3>
    <div id="topicList"></div>
  </div>

  <div class="section">
    <h3>📚 Διπλωματικές στις οποίες συμμετέχω</h3>
    <div id="thesisList"></div>
  </div>

  <script>
    const token = localStorage.getItem('token');
    if (!token) {
      alert('Πρέπει να συνδεθείτε πρώτα.');
      window.location.href = 'login.html';
    }

    const topicForm = document.getElementById('topicForm');
    const topicList = document.getElementById('topicList');
    const thesisList = document.getElementById('thesisList');

    // POST νέο θέμα
    topicForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData();
      formData.append('title', topicForm.title.value);
      formData.append('summary', topicForm.summary.value);
      if (topicForm.pdfFile.files[0]) {
        formData.append('pdf', topicForm.pdfFile.files[0]);
      }

      const res = await fetch('http://localhost:5000/api/instructors/topics', {
        method: 'POST',
        headers: { Authorization: `Bearer ${token}` },
        body: formData
      });

      if (res.ok) {
        alert('✅ Το θέμα καταχωρήθηκε!');
        topicForm.reset();
        loadTopics();
      } else {
        alert('❌ Σφάλμα κατά την καταχώρηση');
      }
    });

    // GET θέματα καθηγητή
    async function loadTopics() {
      const res = await fetch('http://localhost:5000/api/instructors/topics', {
        headers: { Authorization: `Bearer ${token}` }
      });
      const topics = await res.json();

      topicList.innerHTML = '';
      topics.forEach(t => {
        const div = document.createElement('div');
        div.className = 'topic';
        div.innerHTML = `<strong>${t.title}</strong><br>${t.summary}<br>`;
        topicList.appendChild(div);
      });
    }

    // GET διπλωματικές καθηγητή
    async function loadTheses() {
      const res = await fetch('http://localhost:5000/api/instructors/theses', {
        headers: { Authorization: `Bearer ${token}` }
      });
      const theses = await res.json();

      thesisList.innerHTML = '';
      theses.forEach(th => {
        const div = document.createElement('div');
        div.className = 'thesis';
        div.innerHTML = `
          <strong>Θέμα:</strong> ${th.topic.title}<br>
          <strong>Φοιτητής:</strong> ${th.student.name}<br>
          <strong>Κατάσταση:</strong> ${th.status}<br>
        `;
        thesisList.appendChild(div);
      });
    }

    loadTopics();
    loadTheses();
  </script>

</body>
</html>
